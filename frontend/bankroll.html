<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Bankroll - SurePro</title>
    
    <!-- Fontes e Ícones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f8fafc;
            --gradient-premium: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-premium {
            background: var(--gradient-premium);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #9ca3af;
            text-decoration: none;
            margin-bottom: 2rem;
            transition: color 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }
        
        .back-btn:hover {
            color: var(--primary);
            background: rgba(255,255,255,0.05);
        }
        
        /* Overview Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .overview-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .overview-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .overview-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .overview-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .icon-primary { background: rgba(99, 102, 241, 0.2); color: var(--primary); }
        .icon-success { background: rgba(16, 185, 129, 0.2); color: var(--secondary); }
        .icon-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .icon-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .overview-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .overview-label {
            color: #9ca3af;
            font-size: 0.9rem;
        }
        
        .overview-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
        
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Allocation Grid */
        .allocation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .allocation-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .allocation-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .allocation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .allocation-item:hover {
            background: rgba(255,255,255,0.08);
        }
        
        .allocation-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .allocation-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .allocation-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin: 0 1rem;
            overflow: hidden;
        }
        
        .allocation-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* Transactions */
        .transactions-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
        }
        
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .transactions-table th {
            text-align: left;
            padding: 1rem;
            color: #9ca3af;
            font-weight: 500;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }
        
        .transactions-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }
        
        .transactions-table tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .transaction-type {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .type-deposit {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }
        
        .type-withdrawal {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        .type-profit {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }
        
        /* Risk Management */
        .risk-management {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .risk-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .risk-indicator {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        
        .risk-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .risk-low { color: var(--secondary); }
        .risk-medium { color: var(--warning); }
        .risk-high { color: var(--danger); }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #9ca3af;
            font-weight: 500;
        }
        
        .input-field {
            width: 100%;
            padding: 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.15);
        }
        
        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="dashboard.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            Voltar ao Dashboard
        </a>
        
        <div class="header">
            <h1><i class="fas fa-wallet"></i> Gestão de Bankroll</h1>
            <div class="header-actions">
                <button class="btn-premium" onclick="showDepositModal()">
                    <i class="fas fa-plus"></i> Depositar
                </button>
                <button class="btn-secondary" onclick="showWithdrawModal()">
                    <i class="fas fa-minus"></i> Retirar
                </button>
                <button class="btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
            </div>
        </div>
        
        <!-- Overview Cards -->
        <div class="overview-grid">
            <div class="overview-card">
                <div class="overview-header">
                    <div class="overview-icon icon-primary">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div>
                        <div class="overview-value profit-positive" id="currentBalance">R$ 12.847,50</div>
                        <div class="overview-label">Saldo Atual</div>
                    </div>
                </div>
                <div class="overview-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+28.5% desde o início</span>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="overview-header">
                    <div class="overview-icon icon-success">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <div class="overview-value profit-positive" id="totalProfit">R$ 2.847,50</div>
                        <div class="overview-label">Lucro Total</div>
                    </div>
                </div>
                <div class="overview-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12.5% este mês</span>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="overview-header">
                    <div class="overview-icon icon-warning">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div>
                        <div class="overview-value" id="avgStake">4.27%</div>
                        <div class="overview-label">Stake Médio</div>
                    </div>
                </div>
                <div class="overview-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+0.8% desde ontem</span>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="overview-header">
                    <div class="overview-icon icon-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div>
                        <div class="overview-value" id="riskLevel">MÉDIO</div>
                        <div class="overview-label">Nível de Risco</div>
                    </div>
                </div>
                <div class="overview-trend trend-up">
                    <i class="fas fa-check"></i>
                    <span>Dentro do limite</span>
                </div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Evolução do Bankroll</h3>
                    <select class="input-field" style="width: auto; padding: 0.5rem 1rem;" onchange="updateChartPeriod(this.value)">
                        <option value="week">Última Semana</option>
                        <option value="month" selected>Último Mês</option>
                        <option value="quarter">Último Trimestre</option>
                        <option value="year">Último Ano</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="bankrollChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Alocação por Esporte</h3>
                </div>
                <div class="chart-container">
                    <canvas id="allocationChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Allocation and Risk -->
        <div class="allocation-grid">
            <div class="allocation-card">
                <h3 style="margin-bottom: 1.5rem;">Alocação Detalhada</h3>
                <div id="allocationList">
                    <!-- Alocação será preenchida via JavaScript -->
                </div>
            </div>
            
            <div class="risk-management">
                <h3 style="margin-bottom: 1.5rem;">Gestão de Risco</h3>
                <div class="risk-indicators">
                    <div class="risk-indicator">
                        <div class="risk-value risk-low" id="varIndicator">2.3%</div>
                        <div class="overview-label">VaR Diário</div>
                    </div>
                    <div class="risk-indicator">
                        <div class="risk-value risk-medium" id="maxDrawdown">-5.2%</div>
                        <div class="overview-label">Max Drawdown</div>
                    </div>
                    <div class="risk-indicator">
                        <div class="risk-value risk-low" id="sharpeRatio">1.8</div>
                        <div class="overview-label">Sharpe Ratio</div>
                    </div>
                    <div class="risk-indicator">
                        <div class="risk-value risk-medium" id="volatility">12.4%</div>
                        <div class="overview-label">Volatilidade</div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Recomendações</h4>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <p style="margin: 0; font-size: 0.9rem;">✅ Seu bankroll está bem diversificado e dentro dos limites de risco recomendados. Continue com a estratégia atual.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Transactions -->
        <div class="transactions-card">
            <div class="chart-header">
                <h3 class="chart-title">Últimas Transações</h3>
                <button class="btn-secondary" onclick="showAllTransactions()">
                    <i class="fas fa-list"></i> Ver Todas
                </button>
            </div>
            <div style="overflow-x: auto;">
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Descrição</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTable">
                        <!-- Transações serão preenchidas via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modal de Depósito -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Depositar Fundos</h2>
                <button class="modal-close" onclick="closeDepositModal()">&times;</button>
            </div>
            <div class="input-group">
                <label class="input-label">Valor (R$)</label>
                <input type="number" class="input-field" id="depositAmount" placeholder="0.00" step="0.01" min="0">
            </div>
            <div class="input-group">
                <label class="input-label">Método de Pagamento</label>
                <select class="input-field" id="depositMethod">
                    <option value="pix">PIX</option>
                    <option value="credit_card">Cartão de Crédito</option>
                    <option value="bank_transfer">Transferência Bancária</option>
                    <option value="crypto">Criptomoeda</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">Observações (Opcional)</label>
                <textarea class="input-field" id="depositNotes" placeholder="Alguma observação sobre este depósito..." rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeDepositModal()" style="flex: 1;">Cancelar</button>
                <button class="btn-premium" onclick="processDeposit()" style="flex: 1;">
                    <i class="fas fa-check"></i> Confirmar Depósito
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Retirada -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Retirar Fundos</h2>
                <button class="modal-close" onclick="closeWithdrawModal()">&times;</button>
            </div>
            <div class="input-group">
                <label class="input-label">Valor (R$)</label>
                <input type="number" class="input-field" id="withdrawAmount" placeholder="0.00" step="0.01" min="0">
            </div>
            <div class="input-group">
                <label class="input-label">Método de Retirada</label>
                <select class="input-field" id="withdrawMethod">
                    <option value="pix">PIX</option>
                    <option value="bank_transfer">Transferência Bancária</option>
                    <option value="crypto">Criptomoeda</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">Chave PIX/Conta</label>
                <input type="text" class="input-field" id="withdrawAccount" placeholder="Chave PIX, número da conta, etc.">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeWithdrawModal()" style="flex: 1;">Cancelar</button>
                <button class="btn-premium" onclick="processWithdrawal()" style="flex: 1;">
                    <i class="fas fa-check"></i> Confirmar Retirada
                </button>
            </div>
        </div>
    </div>

   <script>
    // ✅ URL DA API CORRIGIDA
    const API_URL = 'https://sistema-surebets-premium-ba6dc287994f.herokuapp.com/api';
    
    let bankrollChart, allocationChart;
    
    // Carregar dados do bankroll
    async function loadBankrollData() {
        try {
            // ✅ API CALL CORRIGIDA
            const response = await fetch(API_URL + '/bankroll');
            const data = await response.json();
            updateBankrollUI(data);
            initializeCharts(data);
        } catch (error) {
            console.error('Erro ao carregar dados do bankroll:', error);
            // Dados de exemplo para demonstração
            loadSampleData();
        }
    }
    
    function loadSampleData() {
        const sampleData = {
            current: 12847.50,
            initial: 10000.00,
            profit: 2847.50,
            growth: 28.48,
            daily: [
                { date: '2024-12-20', value: 12000 },
                { date: '2024-12-21', value: 12250 },
                { date: '2024-12-22', value: 12500 },
                { date: '2024-12-23', value: 12600 },
                { date: '2024-12-24', value: 12847.50 }
            ],
            allocation: [
                { sport: 'Futebol', amount: 6000, percentage: 46.7 },
                { sport: 'Tênis', amount: 3500, percentage: 27.2 },
                { sport: 'Basquete', amount: 2000, percentage: 15.6 },
                { sport: 'Outros', amount: 1347.50, percentage: 10.5 }
            ],
            performance: {
                monthlyReturn: 12.5,
                weeklyReturn: 2.8,
                bestDay: 684.25,
                worstDay: -45.80
            }
        };
        
        updateBankrollUI(sampleData);
        initializeCharts(sampleData);
        loadSampleTransactions();
    }
    
    function updateBankrollUI(data) {
        document.getElementById('currentBalance').textContent = `R$ ${data.current.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        document.getElementById('totalProfit').textContent = `R$ ${data.profit.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        document.getElementById('avgStake').textContent = `${((data.current - data.initial) / data.initial * 100 / 12).toFixed(2)}%`;
        
        // Atualizar alocação
        const allocationList = document.getElementById('allocationList');
        allocationList.innerHTML = data.allocation.map(item => {
            const color = getSportColor(item.sport);
            return `
                <div class="allocation-item">
                    <div class="allocation-info">
                        <div class="allocation-color" style="background: ${color};"></div>
                        <span>${item.sport}</span>
                    </div>
                    <div class="allocation-bar">
                        <div class="allocation-fill" style="width: ${item.percentage}%; background: ${color};"></div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600;">R$ ${item.amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        <div style="font-size: 0.8rem; color: #9ca3af;">${item.percentage}%</div>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function getSportColor(sport) {
        const colors = {
            'Futebol': '#6366f1',
            'Tênis': '#10b981', 
            'Basquete': '#f59e0b',
            'Outros': '#6b7280'
        };
        return colors[sport] || '#6b7280';
    }
    
    function initializeCharts(data) {
        // Gráfico de Evolução do Bankroll
        const bankrollCtx = document.getElementById('bankrollChart').getContext('2d');
        bankrollChart = new Chart(bankrollCtx, {
            type: 'line',
            data: {
                labels: data.daily.map(item => new Date(item.date).toLocaleDateString('pt-BR')),
                datasets: [{
                    label: 'Bankroll (R$)',
                    data: data.daily.map(item => item.value),
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        },
                        ticks: {
                            color: '#9ca3af',
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR');
                            }
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        },
                        ticks: {
                            color: '#9ca3af'
                        }
                    }
                }
            }
        });
        
        // Gráfico de Alocação
        const allocationCtx = document.getElementById('allocationChart').getContext('2d');
        allocationChart = new Chart(allocationCtx, {
            type: 'doughnut',
            data: {
                labels: data.allocation.map(item => item.sport),
                datasets: [{
                    data: data.allocation.map(item => item.percentage),
                    backgroundColor: data.allocation.map(item => getSportColor(item.sport)),
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#9ca3af',
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });
    }
    
    function loadSampleTransactions() {
        const transactions = [
            { date: '2024-12-25', description: 'Lucro - Flamengo vs Vasco', type: 'profit', amount: 47.62, balance: 12847.50 },
            { date: '2024-12-25', description: 'Lucro - Lakers vs Warriors', type: 'profit', amount: 24.96, balance: 12800.00 },
            { date: '2024-12-24', description: 'Depósito via PIX', type: 'deposit', amount: 1000.00, balance: 12750.00 },
            { date: '2024-12-23', description: 'Retirada para investimento', type: 'withdrawal', amount: -500.00, balance: 11750.00 },
            { date: '2024-12-22', description: 'Lucro - Nadal vs Djokovic', type: 'profit', amount: 29.40, balance: 12250.00 }
        ];
        
        const tbody = document.getElementById('transactionsTable');
        tbody.innerHTML = transactions.map(transaction => `
            <tr>
                <td>${new Date(transaction.date).toLocaleDateString('pt-BR')}</td>
                <td>${transaction.description}</td>
                <td>
                    <span class="transaction-type type-${transaction.type}">
                        ${getTransactionTypeText(transaction.type)}
                    </span>
                </td>
                <td class="${transaction.amount > 0 ? 'profit-positive' : 'profit-negative'}">
                    <strong>${transaction.amount > 0 ? '+' : ''}R$ ${Math.abs(transaction.amount).toFixed(2)}</strong>
                </td>
                <td>R$ ${transaction.balance.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
            </tr>
        `).join('');
    }
    
    function getTransactionTypeText(type) {
        const typeMap = {
            'deposit': 'Depósito',
            'withdrawal': 'Retirada',
            'profit': 'Lucro'
        };
        return typeMap[type] || type;
    }
    
    // Modal Functions
    function showDepositModal() {
        document.getElementById('depositModal').style.display = 'block';
        document.getElementById('depositAmount').focus();
    }
    
    function closeDepositModal() {
        document.getElementById('depositModal').style.display = 'none';
        document.getElementById('depositAmount').value = '';
        document.getElementById('depositNotes').value = '';
    }
    
    function showWithdrawModal() {
        document.getElementById('withdrawModal').style.display = 'block';
        document.getElementById('withdrawAmount').focus();
    }
    
    function closeWithdrawModal() {
        document.getElementById('withdrawModal').style.display = 'none';
        document.getElementById('withdrawAmount').value = '';
        document.getElementById('withdrawAccount').value = '';
    }
    
    async function processDeposit() {
        const amount = parseFloat(document.getElementById('depositAmount').value);
        const method = document.getElementById('depositMethod').value;
        const notes = document.getElementById('depositNotes').value;
        
        if (!amount || amount <= 0) {
            alert('Por favor, insira um valor válido para depósito.');
            return;
        }
        
        try {
            // ✅ API CALL CORRIGIDA
            const response = await fetch(API_URL + '/bankroll', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('surebet_token')}`
                },
                body: JSON.stringify({
                    amount: amount,
                    operation: 'deposit',
                    method: method,
                    notes: notes
                })
            });
            
            if (response.ok) {
                alert(`Depósito de R$ ${amount.toFixed(2)} realizado com sucesso!`);
                closeDepositModal();
                loadBankrollData();
            } else {
                alert('Erro ao processar depósito.');
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('Depósito simulado com sucesso! Em produção, isso integraria com um gateway de pagamento.');
            closeDepositModal();
            loadBankrollData();
        }
    }
    
    async function processWithdrawal() {
        const amount = parseFloat(document.getElementById('withdrawAmount').value);
        const method = document.getElementById('withdrawMethod').value;
        const account = document.getElementById('withdrawAccount').value;
        
        if (!amount || amount <= 0) {
            alert('Por favor, insira um valor válido para retirada.');
            return;
        }
        
        if (!account) {
            alert('Por favor, informe a chave/conta para a retirada.');
            return;
        }
        
        try {
            // ✅ API CALL CORRIGIDA
            const response = await fetch(API_URL + '/bankroll', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('surebet_token')}`
                },
                body: JSON.stringify({
                    amount: amount,
                    operation: 'withdraw',
                    method: method,
                    account: account
                })
            });
            
            if (response.ok) {
                alert(`Retirada de R$ ${amount.toFixed(2)} solicitada com sucesso!`);
                closeWithdrawModal();
                loadBankrollData();
            } else {
                alert('Erro ao processar retirada.');
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('Retirada simulada com sucesso! Em produção, isso processaria a transferência.');
            closeWithdrawModal();
            loadBankrollData();
        }
    }
    
    function updateChartPeriod(period) {
        // Em produção, isso recarregaria os dados do período selecionado
        alert(`Período alterado para: ${period}`);
    }
    
    function showAllTransactions() {
        alert('Abrindo histórico completo de transações...');
        // Em produção, isso abriria uma página com todas as transações
    }
    
    function refreshData() {
        loadBankrollData();
    }
    
    // Carregar dados ao iniciar
    document.addEventListener('DOMContentLoaded', loadBankrollData);
    
    // Fechar modal ao clicar fora
    window.onclick = function(event) {
        const modals = document.getElementsByClassName('modal');
        for (let modal of modals) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    }
</script>
</body>

</html>
